<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لوحة مبادرات المدرسة</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">

<style>
body{font-family:'Cairo',sans-serif;background:#f5f7fb;margin:0;padding:20px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
button{cursor:pointer}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-bottom:20px}
.card{background:white;padding:15px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,.08)}
.search input{width:100%;padding:10px;border-radius:10px;border:none;box-shadow:0 5px 15px rgba(0,0,0,.08)}
.list .item{background:white;padding:15px;border-radius:12px;margin-top:10px;display:flex;justify-content:space-between;box-shadow:0 5px 15px rgba(0,0,0,.08)}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center}
.modal-content{background:white;padding:20px;border-radius:12px;width:300px}
.modal-content input,.modal-content select{width:100%;padding:8px;margin-bottom:10px}
</style>
</head>
<body>

<div class="header">
<h2>لوحة مبادرات المدرسة</h2>
<button onclick="openModal()">＋ إضافة</button>
</div>

<div class="stats">
<div class="card"><h3 id="total">0</h3><p>إجمالي</p></div>
<div class="card"><h3 id="active">0</h3><p>نشطة</p></div>
</div>

<div class="search">
<input type="text" id="search" placeholder="بحث..." oninput="render()">
</div>

<div class="list" id="list"></div>

<div class="modal" id="modal">
<div class="modal-content">
<input id="title" placeholder="اسم المبادرة">
<input id="teacher" placeholder="اسم المعلمة">
<input id="progress" type="number" placeholder="نسبة الإنجاز">
<select id="status">
<option value="نشطة">نشطة</option>
<option value="مخططة">مخططة</option>
<option value="مكتملة">مكتملة</option>
</select>
<button onclick="addData()">حفظ</button>
</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAp72WZAumRsHaGTz8cFuztWK9p1bPJhYE",
  authDomain: "school-initiatves.firebaseapp.com",
  projectId: "school-initiatves",
  storageBucket: "school-initiatves.firebasestorage.app",
  messagingSenderId: "1076583507246",
  appId: "1:1076583507246:web:66c642ff336437af1dc6bf"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.openModal = ()=>document.getElementById("modal").style.display="flex";
window.closeModal = ()=>document.getElementById("modal").style.display="none";

window.addData = async ()=>{
  const title=document.getElementById("title").value;
  const teacher=document.getElementById("teacher").value;
  const progress=parseInt(document.getElementById("progress").value)||0;
  const status=document.getElementById("status").value;

  if(!title||!teacher)return alert("أكملي البيانات");

  await addDoc(collection(db,"initiatives"),{
    title,teacher,progress,status
  });

  closeModal();
  loadData();
};

async function loadData(){
  const querySnapshot = await getDocs(collection(db,"initiatives"));
  window.data=[];
  querySnapshot.forEach(docSnap=>{
    window.data.push({...docSnap.data(),id:docSnap.id});
  });
  render();
}

window.render = ()=>{
  const list=document.getElementById("list");
  list.innerHTML="";
  const search=document.getElementById("search").value||"";

  const filtered=window.data.filter(i=>i.title.includes(search));

  filtered.forEach(item=>{
    list.innerHTML+=`
    <div class="item">
      <div>
      <strong>${item.title}</strong><br>
      ${item.teacher} - ${item.status} - ${item.progress}%
      </div>
      <button onclick="deleteItem('${item.id}')">حذف</button>
    </div>`;
  });

  document.getElementById("total").innerText=window.data.length;
  document.getElementById("active").innerText=
  window.data.filter(i=>i.status==="نشطة").length;
};

window.deleteItem = async(id)=>{
  await deleteDoc(doc(db,"initiatives",id));
  loadData();
};

loadData();

</script>

</body>
</html>
